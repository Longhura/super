-- FlyToPlayerScript.lua
-- A script that allows flying to designated players with various options

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlyToPlayerGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- Circular Icon (Initially visible)
local CircleIcon = Instance.new("ImageButton")
CircleIcon.Name = "CircleIcon"
CircleIcon.Size = UDim2.new(0, 50, 0, 50)
CircleIcon.Position = UDim2.new(0.9, 0, 0.5, 0)
CircleIcon.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
CircleIcon.BorderSizePixel = 0
CircleIcon.Image = "rbxassetid://3926307971" -- Roblox asset ID for a fly icon
CircleIcon.ImageRectOffset = Vector2.new(324, 364)
CircleIcon.ImageRectSize = Vector2.new(36, 36)
CircleIcon.ImageColor3 = Color3.fromRGB(255, 255, 255)
CircleIcon.Parent = ScreenGui
CircleIcon.Active = true -- Make it interactive
CircleIcon.Draggable = true -- Make it draggable

-- Make the icon circular
local IconCorner = Instance.new("UICorner")
IconCorner.CornerRadius = UDim.new(1, 0)
IconCorner.Parent = CircleIcon

-- Main Frame (Initially hidden)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 250) -- Shorter main menu
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -125)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = false
MainFrame.Parent = ScreenGui

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -100, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "Fly To Player"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextSize = 18
TitleText.Font = Enum.Font.GothamSemibold
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -60, 0, 0)
MinimizeButton.BackgroundTransparency = 1
MinimizeButton.Text = "−"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 18
MinimizeButton.Font = Enum.Font.GothamSemibold
MinimizeButton.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundTransparency = 1
CloseButton.Text = "✕"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.GothamSemibold
CloseButton.Parent = TitleBar

-- Content Frame
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -40)
ContentFrame.Position = UDim2.new(0, 10, 0, 35)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Fly Toggle (Main Menu)
local FlyToggle = Instance.new("Frame")
FlyToggle.Name = "FlyToggle"
FlyToggle.Size = UDim2.new(1, 0, 0, 30)
FlyToggle.BackgroundTransparency = 1
FlyToggle.Parent = ContentFrame

local FlyLabel = Instance.new("TextLabel")
FlyLabel.Name = "FlyLabel"
FlyLabel.Size = UDim2.new(0.7, 0, 1, 0)
FlyLabel.BackgroundTransparency = 1
FlyLabel.Text = "Enable Flying"
FlyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyLabel.TextSize = 16
FlyLabel.Font = Enum.Font.Gotham
FlyLabel.TextXAlignment = Enum.TextXAlignment.Left
FlyLabel.Parent = FlyToggle

local FlyButton = Instance.new("TextButton")
FlyButton.Name = "FlyButton"
FlyButton.Size = UDim2.new(0.3, -10, 1, -10)
FlyButton.Position = UDim2.new(0.7, 0, 0, 5)
FlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
FlyButton.BorderSizePixel = 0
FlyButton.Text = "OFF"
FlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyButton.TextSize = 14
FlyButton.Font = Enum.Font.GothamSemibold
FlyButton.Parent = FlyToggle

-- Add this right after the FlyToggle section in your ContentFrame

-- Auto Fly Toggle
local AutoFlyToggle = Instance.new("Frame")
AutoFlyToggle.Name = "AutoFlyToggle"
AutoFlyToggle.Size = UDim2.new(1, 0, 0, 30)
AutoFlyToggle.Position = UDim2.new(0, 0, 0, 40) -- Position it right below the FlyToggle
AutoFlyToggle.BackgroundTransparency = 1
AutoFlyToggle.Parent = ContentFrame

local AutoFlyLabel = Instance.new("TextLabel")
AutoFlyLabel.Name = "AutoFlyLabel"
AutoFlyLabel.Size = UDim2.new(0.7, 0, 1, 0)
AutoFlyLabel.BackgroundTransparency = 1
AutoFlyLabel.Text = "Auto Fly to Target"
AutoFlyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoFlyLabel.TextSize = 16
AutoFlyLabel.Font = Enum.Font.Gotham
AutoFlyLabel.TextXAlignment = Enum.TextXAlignment.Left
AutoFlyLabel.Parent = AutoFlyToggle

local AutoFlyButton = Instance.new("TextButton")
AutoFlyButton.Name = "AutoFlyButton"
AutoFlyButton.Size = UDim2.new(0.3, -10, 1, -10)
AutoFlyButton.Position = UDim2.new(0.7, 0, 0, 5)
AutoFlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
AutoFlyButton.BorderSizePixel = 0
AutoFlyButton.Text = "OFF"
AutoFlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoFlyButton.TextSize = 14
AutoFlyButton.Font = Enum.Font.GothamSemibold
AutoFlyButton.Parent = AutoFlyToggle

-- Add this to your variables section
local autoFlyEnabled = false
local autoFlyConnection = nil
local bodyGyro, bodyVelocity

-- Add this function to toggle Auto Fly
local function toggleAutoFly()
    autoFlyEnabled = not autoFlyEnabled
    
    if autoFlyEnabled then
        AutoFlyButton.Text = "ON"
        AutoFlyButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if selectedPlayer then
            -- Disable regular flying if it's on
            if flyEnabled and flyConnection then
                flyConnection:Disconnect()
                flyConnection = nil
            end
            
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local hrp = character.HumanoidRootPart
                
                -- Create BodyGyro and BodyVelocity for smoother flying
                if bodyGyro then bodyGyro:Destroy() end
                if bodyVelocity then bodyVelocity:Destroy() end
                
                bodyGyro = Instance.new("BodyGyro")
                bodyGyro.Name = "FlyGyro"
                bodyGyro.P = 9e4
                bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
                bodyGyro.CFrame = hrp.CFrame
                bodyGyro.Parent = hrp
                
                bodyVelocity = Instance.new("BodyVelocity")
                bodyVelocity.Name = "FlyVelocity"
                bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
                bodyVelocity.Velocity = Vector3.new(0, 0.1, 0)
                bodyVelocity.Parent = hrp
                
                -- Create connection for continuous flying
                if autoFlyConnection then
                    autoFlyConnection:Disconnect()
                end
                
                autoFlyConnection = RunService.Heartbeat:Connect(function()
                    if not character or not character:FindFirstChild("HumanoidRootPart") or not selectedPlayer or not selectedPlayer.Character or not selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
                    
                    local targetPos = selectedPlayer.Character.HumanoidRootPart.Position
                    
                    -- Get offset from inputs
                    local offsetX = tonumber(XInput.Text) or 0
                    local offsetY = tonumber(YInput.Text) or 0
                    local offsetZ = tonumber(ZInput.Text) or 0
                    targetPos = targetPos + Vector3.new(offsetX, offsetY, offsetZ)
                    
                    -- Get speed from input
                    local speed = tonumber(SpeedInput.Text) or 50
                    
                    -- Calculate direction and apply velocity
                    local direction = (targetPos - hrp.Position).Unit
                    bodyVelocity.Velocity = direction * speed
                    
                    -- Update orientation to face target
                    bodyGyro.CFrame = CFrame.new(hrp.Position, targetPos)
                end)
            end
        else
            AutoFlyButton.Text = "OFF"
            AutoFlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            autoFlyEnabled = false
            
            -- Show notification to select a player
            local notification = Instance.new("TextLabel")
            notification.Size = UDim2.new(0, 200, 0, 30)
            notification.Position = UDim2.new(0.5, -100, 0.8, 0)
            notification.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            notification.TextColor3 = Color3.fromRGB(255, 255, 255)
            notification.Text = "Please select a player first"
            notification.Font = Enum.Font.GothamSemibold
            notification.TextSize = 14
            notification.Parent = ScreenGui
            
            -- Add corner
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 5)
            corner.Parent = notification
            
            -- Remove after 3 seconds
            game:GetService("Debris"):AddItem(notification, 3)
            return
        end
    else
        AutoFlyButton.Text = "OFF"
        AutoFlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        -- Clean up
        if autoFlyConnection then
            autoFlyConnection:Disconnect()
            autoFlyConnection = nil
        end
        
        if bodyGyro then bodyGyro:Destroy() end
        if bodyVelocity then bodyVelocity:Destroy() end
        
        -- Reset character state
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
        end
    end
end

-- Make corners rounded
makeRounded(AutoFlyButton, 4)

-- Connect the button
AutoFlyButton.MouseButton1Click:Connect(toggleAutoFly)

-- Add cleanup to the CloseButton event
local oldCloseFunction = CloseButton.MouseButton1Click:Connect
CloseButton.MouseButton1Click:Connect(function()
    if autoFlyConnection then autoFlyConnection:Disconnect() end
    if bodyGyro then bodyGyro:Destroy() end
    if bodyVelocity then bodyVelocity:Destroy() end
    oldCloseFunction()
end)

-- Add cleanup to the character death event
local oldHumanoidDiedFunction = Humanoid.Died:Connect
Humanoid.Died:Connect(function()
    autoFlyEnabled = false
    if autoFlyConnection then autoFlyConnection:Disconnect() end
    if bodyGyro then bodyGyro:Destroy() end
    if bodyVelocity then bodyVelocity:Destroy() end
    AutoFlyButton.Text = "OFF"
    AutoFlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    oldHumanoidDiedFunction()
end)

-- Adjust the position of SpeedFrame to make room for the new button
SpeedFrame.Position = UDim2.new(0, 0, 0, 50) -- Move it down to accommodate the new AutoFlyToggle

-- Speed Input (Main Menu)
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Name = "SpeedFrame"
SpeedFrame.Size = UDim2.new(1, 0, 0, 50)
SpeedFrame.Position = UDim2.new(0, 0, 0, 40)
SpeedFrame.BackgroundTransparency = 1
SpeedFrame.Parent = ContentFrame

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(1, 0, 0, 20)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "Flight Speed:"
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedLabel.TextSize = 16
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Parent = SpeedFrame

local SpeedInput = Instance.new("TextBox")
SpeedInput.Name = "SpeedInput"
SpeedInput.Size = UDim2.new(1, 0, 0, 30)
SpeedInput.Position = UDim2.new(0, 0, 0, 20)
SpeedInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
SpeedInput.BorderSizePixel = 0
SpeedInput.Text = "50"
SpeedInput.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedInput.TextSize = 14
SpeedInput.Font = Enum.Font.Gotham
SpeedInput.Parent = SpeedFrame

-- Category Buttons (Main Menu)
local CategoryFrame = Instance.new("Frame")
CategoryFrame.Name = "CategoryFrame"
CategoryFrame.Size = UDim2.new(1, 0, 0, 120)
CategoryFrame.Position = UDim2.new(0, 0, 0, 100)
CategoryFrame.BackgroundTransparency = 1
CategoryFrame.Parent = ContentFrame

-- Movement Category Button
local MovementButton = Instance.new("TextButton")
MovementButton.Name = "MovementButton"
MovementButton.Size = UDim2.new(0.48, 0, 0, 50)
MovementButton.Position = UDim2.new(0, 0, 0, 0)
MovementButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MovementButton.BorderSizePixel = 0
MovementButton.Text = "Movement"
MovementButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MovementButton.TextSize = 16
MovementButton.Font = Enum.Font.GothamSemibold
MovementButton.Parent = CategoryFrame

-- Anti-Stun Category Button
local AntiStunButton = Instance.new("TextButton")
AntiStunButton.Name = "AntiStunButton"
AntiStunButton.Size = UDim2.new(0.48, 0, 0, 50)
AntiStunButton.Position = UDim2.new(0.52, 0, 0, 0)
AntiStunButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
AntiStunButton.BorderSizePixel = 0
AntiStunButton.Text = "Anti-Stun"
AntiStunButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AntiStunButton.TextSize = 16
AntiStunButton.Font = Enum.Font.GothamSemibold
AntiStunButton.Parent = CategoryFrame

-- ESP Category Button
local ESPButton = Instance.new("TextButton")
ESPButton.Name = "ESPButton"
ESPButton.Size = UDim2.new(0.48, 0, 0, 50)
ESPButton.Position = UDim2.new(0, 0, 0, 60)
ESPButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPButton.BorderSizePixel = 0
ESPButton.Text = "ESP"
ESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPButton.TextSize = 16
ESPButton.Font = Enum.Font.GothamSemibold
ESPButton.Parent = CategoryFrame

-- Player List Category Button
local PlayerListButton = Instance.new("TextButton")
PlayerListButton.Name = "PlayerListButton"
PlayerListButton.Size = UDim2.new(0.48, 0, 0, 50)
PlayerListButton.Position = UDim2.new(0.52, 0, 0, 60)
PlayerListButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
PlayerListButton.BorderSizePixel = 0
PlayerListButton.Text = "Player List"
PlayerListButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerListButton.TextSize = 16
PlayerListButton.Font = Enum.Font.GothamSemibold
PlayerListButton.Parent = CategoryFrame

-- Sub-Menu Frames (Initially hidden)
-- Movement Sub-Menu
local MovementMenu = Instance.new("Frame")
MovementMenu.Name = "MovementMenu"
MovementMenu.Size = UDim2.new(0, 250, 0, 200)
MovementMenu.Position = UDim2.new(0, 310, 0, 100)
MovementMenu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MovementMenu.BorderSizePixel = 0
MovementMenu.Visible = false
MovementMenu.Parent = ScreenGui

local MovementTitle = Instance.new("TextLabel")
MovementTitle.Name = "MovementTitle"
MovementTitle.Size = UDim2.new(1, 0, 0, 30)
MovementTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MovementTitle.BorderSizePixel = 0
MovementTitle.Text = "Movement Options"
MovementTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
MovementTitle.TextSize = 16
MovementTitle.Font = Enum.Font.GothamSemibold
MovementTitle.Parent = MovementMenu

local MovementContent = Instance.new("Frame")
MovementContent.Name = "MovementContent"
MovementContent.Size = UDim2.new(1, -20, 1, -40)
MovementContent.Position = UDim2.new(0, 10, 0, 35)
MovementContent.BackgroundTransparency = 1
MovementContent.Parent = MovementMenu

-- Noclip Toggle
local NoclipToggle = Instance.new("Frame")
NoclipToggle.Name = "NoclipToggle"
NoclipToggle.Size = UDim2.new(1, 0, 0, 30)
NoclipToggle.Position = UDim2.new(0, 0, 0, 0)
NoclipToggle.BackgroundTransparency = 1
NoclipToggle.Parent = MovementContent

local NoclipLabel = Instance.new("TextLabel")
NoclipLabel.Name = "NoclipLabel"
NoclipLabel.Size = UDim2.new(0.7, 0, 1, 0)
NoclipLabel.BackgroundTransparency = 1
NoclipLabel.Text = "Pass Through Objects"
NoclipLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NoclipLabel.TextSize = 16
NoclipLabel.Font = Enum.Font.Gotham
NoclipLabel.TextXAlignment = Enum.TextXAlignment.Left
NoclipLabel.Parent = NoclipToggle

local NoclipButton = Instance.new("TextButton")
NoclipButton.Name = "NoclipButton"
NoclipButton.Size = UDim2.new(0.3, -10, 1, -10)
NoclipButton.Position = UDim2.new(0.7, 0, 0, 5)
NoclipButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
NoclipButton.BorderSizePixel = 0
NoclipButton.Text = "OFF"
NoclipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
NoclipButton.TextSize = 14
NoclipButton.Font = Enum.Font.GothamSemibold
NoclipButton.Parent = NoclipToggle

-- Continuous Flying Toggle
local ContinuousToggle = Instance.new("Frame")
ContinuousToggle.Name = "ContinuousToggle"
ContinuousToggle.Size = UDim2.new(1, 0, 0, 30)
ContinuousToggle.Position = UDim2.new(0, 0, 0, 40)
ContinuousToggle.BackgroundTransparency = 1
ContinuousToggle.Parent = MovementContent

local ContinuousLabel = Instance.new("TextLabel")
ContinuousLabel.Name = "ContinuousLabel"
ContinuousLabel.Size = UDim2.new(0.7, 0, 1, 0)
ContinuousLabel.BackgroundTransparency = 1
ContinuousLabel.Text = "Continuous Flying"
ContinuousLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ContinuousLabel.TextSize = 16
ContinuousLabel.Font = Enum.Font.Gotham
ContinuousLabel.TextXAlignment = Enum.TextXAlignment.Left
ContinuousLabel.Parent = ContinuousToggle

local ContinuousButton = Instance.new("TextButton")
ContinuousButton.Name = "ContinuousButton"
ContinuousButton.Size = UDim2.new(0.3, -10, 1, -10)
ContinuousButton.Position = UDim2.new(0.7, 0, 0, 5)
ContinuousButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ContinuousButton.BorderSizePixel = 0
ContinuousButton.Text = "OFF"
ContinuousButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ContinuousButton.TextSize = 14
ContinuousButton.Font = Enum.Font.GothamSemibold
ContinuousButton.Parent = ContinuousToggle

-- Teleport Button
local TeleportFrame = Instance.new("Frame")
TeleportFrame.Name = "TeleportFrame"
TeleportFrame.Size = UDim2.new(1, 0, 0, 30)
TeleportFrame.Position = UDim2.new(0, 0, 0, 80)
TeleportFrame.BackgroundTransparency = 1
TeleportFrame.Parent = MovementContent

local TeleportLabel = Instance.new("TextLabel")
TeleportLabel.Name = "TeleportLabel"
TeleportLabel.Size = UDim2.new(0.7, 0, 1, 0)
TeleportLabel.BackgroundTransparency = 1
TeleportLabel.Text = "Teleport to Player"
TeleportLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportLabel.TextSize = 16
TeleportLabel.Font = Enum.Font.Gotham
TeleportLabel.TextXAlignment = Enum.TextXAlignment.Left
TeleportLabel.Parent = TeleportFrame

local TeleportButton = Instance.new("TextButton")
TeleportButton.Name = "TeleportButton"
TeleportButton.Size = UDim2.new(0.3, -10, 1, -10)
TeleportButton.Position = UDim2.new(0.7, 0, 0, 5)
TeleportButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
TeleportButton.BorderSizePixel = 0
TeleportButton.Text = "TELEPORT"
TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportButton.TextSize = 12
TeleportButton.Font = Enum.Font.GothamSemibold
TeleportButton.Parent = TeleportFrame

-- Auto Teleport Toggle
local AutoTeleportToggle = Instance.new("Frame")
AutoTeleportToggle.Name = "AutoTeleportToggle"
AutoTeleportToggle.Size = UDim2.new(1, 0, 0, 30)
AutoTeleportToggle.Position = UDim2.new(0, 0, 0, 120)
AutoTeleportToggle.BackgroundTransparency = 1
AutoTeleportToggle.Parent = MovementContent

local AutoTeleportLabel = Instance.new("TextLabel")
AutoTeleportLabel.Name = "AutoTeleportLabel"
AutoTeleportLabel.Size = UDim2.new(0.7, 0, 1, 0)
AutoTeleportLabel.BackgroundTransparency = 1
AutoTeleportLabel.Text = "Auto Teleport"
AutoTeleportLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoTeleportLabel.TextSize = 16
AutoTeleportLabel.Font = Enum.Font.Gotham
AutoTeleportLabel.TextXAlignment = Enum.TextXAlignment.Left
AutoTeleportLabel.Parent = AutoTeleportToggle

local AutoTeleportButton = Instance.new("TextButton")
AutoTeleportButton.Name = "AutoTeleportButton"
AutoTeleportButton.Size = UDim2.new(0.3, -10, 1, -10)
AutoTeleportButton.Position = UDim2.new(0.7, 0, 0, 5)
AutoTeleportButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
AutoTeleportButton.BorderSizePixel = 0
AutoTeleportButton.Text = "OFF"
AutoTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoTeleportButton.TextSize = 14
AutoTeleportButton.Font = Enum.Font.GothamSemibold
AutoTeleportButton.Parent = AutoTeleportToggle

-- Anti-Stun Sub-Menu
local AntiStunMenu = Instance.new("Frame")
AntiStunMenu.Name = "AntiStunMenu"
AntiStunMenu.Size = UDim2.new(0, 250, 0, 230)
AntiStunMenu.Position = UDim2.new(0, 310, 0, 100)
AntiStunMenu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
AntiStunMenu.BorderSizePixel = 0
AntiStunMenu.Visible = false
AntiStunMenu.Parent = ScreenGui

local AntiStunTitle = Instance.new("TextLabel")
AntiStunTitle.Name = "AntiStunTitle"
AntiStunTitle.Size = UDim2.new(1, 0, 0, 30)
AntiStunTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
AntiStunTitle.BorderSizePixel = 0
AntiStunTitle.Text = "Anti-Stun Options"
AntiStunTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
AntiStunTitle.TextSize = 16
AntiStunTitle.Font = Enum.Font.GothamSemibold
AntiStunTitle.Parent = AntiStunMenu

local AntiStunContent = Instance.new("Frame")
AntiStunContent.Name = "AntiStunContent"
AntiStunContent.Size = UDim2.new(1, -20, 1, -40)
AntiStunContent.Position = UDim2.new(0, 10, 0, 35)
AntiStunContent.BackgroundTransparency = 1
AntiStunContent.Parent = AntiStunMenu

-- No Stun Toggle
local NoStunToggle = Instance.new("Frame")
NoStunToggle.Name = "NoStunToggle"
NoStunToggle.Size = UDim2.new(1, 0, 0, 30)
NoStunToggle.Position = UDim2.new(0, 0, 0, 0)
NoStunToggle.BackgroundTransparency = 1
NoStunToggle.Parent = AntiStunContent

local NoStunLabel = Instance.new("TextLabel")
NoStunLabel.Name = "NoStunLabel"
NoStunLabel.Size = UDim2.new(0.7, 0, 1, 0)
NoStunLabel.BackgroundTransparency = 1
NoStunLabel.Text = "No Stun"
NoStunLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NoStunLabel.TextSize = 16
NoStunLabel.Font = Enum.Font.Gotham
NoStunLabel.TextXAlignment = Enum.TextXAlignment.Left
NoStunLabel.Parent = NoStunToggle

local NoStunButton = Instance.new("TextButton")
NoStunButton.Name = "NoStunButton"
NoStunButton.Size = UDim2.new(0.3, -10, 1, -10)
NoStunButton.Position = UDim2.new(0.7, 0, 0, 5)
NoStunButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
NoStunButton.BorderSizePixel = 0
NoStunButton.Text = "OFF"
NoStunButton.TextColor3 = Color3.fromRGB(255, 255, 255)
NoStunButton.TextSize = 14
NoStunButton.Font = Enum.Font.GothamSemibold
NoStunButton.Parent = NoStunToggle

-- No Stun V2 + Anti Freeze Toggle
local NoStunV2Toggle = Instance.new("Frame")
NoStunV2Toggle.Name = "NoStunV2Toggle"
NoStunV2Toggle.Size = UDim2.new(1, 0, 0, 30)
NoStunV2Toggle.Position = UDim2.new(0, 0, 0, 40)
NoStunV2Toggle.BackgroundTransparency = 1
NoStunV2Toggle.Parent = AntiStunContent

local NoStunV2Label = Instance.new("TextLabel")
NoStunV2Label.Name = "NoStunV2Label"
NoStunV2Label.Size = UDim2.new(0.7, 0, 1, 0)
NoStunV2Label.BackgroundTransparency = 1
NoStunV2Label.Text = "No Stun V2 + Anti Freeze"
NoStunV2Label.TextColor3 = Color3.fromRGB(255, 255, 255)
NoStunV2Label.TextSize = 16
NoStunV2Label.Font = Enum.Font.Gotham
NoStunV2Label.TextXAlignment = Enum.TextXAlignment.Left
NoStunV2Label.Parent = NoStunV2Toggle

local NoStunV2Button = Instance.new("TextButton")
NoStunV2Button.Name = "NoStunV2Button"
NoStunV2Button.Size = UDim2.new(0.3, -10, 1, -10)
NoStunV2Button.Position = UDim2.new(0.7, 0, 0, 5)
NoStunV2Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
NoStunV2Button.BorderSizePixel = 0
NoStunV2Button.Text = "OFF"
NoStunV2Button.TextColor3 = Color3.fromRGB(255, 255, 255)
NoStunV2Button.TextSize = 14
NoStunV2Button.Font = Enum.Font.GothamSemibold
NoStunV2Button.Parent = NoStunV2Toggle

-- Auto Run Toggle (Emergency Escape)
local AutoRunToggle = Instance.new("Frame")
AutoRunToggle.Name = "AutoRunToggle"
AutoRunToggle.Size = UDim2.new(1, 0, 0, 30)
AutoRunToggle.Position = UDim2.new(0, 0, 0, 80)
AutoRunToggle.BackgroundTransparency = 1
AutoRunToggle.Parent = AntiStunContent

local AutoRunLabel = Instance.new("TextLabel")
AutoRunLabel.Name = "AutoRunLabel"
AutoRunLabel.Size = UDim2.new(0.7, 0, 1, 0)
AutoRunLabel.BackgroundTransparency = 1
AutoRunLabel.Text = "Auto Run (Low HP Escape)"
AutoRunLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoRunLabel.TextSize = 16
AutoRunLabel.Font = Enum.Font.Gotham
AutoRunLabel.TextXAlignment = Enum.TextXAlignment.Left
AutoRunLabel.Parent = AutoRunToggle

local AutoRunButton = Instance.new("TextButton")
AutoRunButton.Name = "AutoRunButton"
AutoRunButton.Size = UDim2.new(0.3, -10, 1, -10)
AutoRunButton.Position = UDim2.new(0.7, 0, 0, 5)
AutoRunButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
AutoRunButton.BorderSizePixel = 0
AutoRunButton.Text = "OFF"
AutoRunButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoRunButton.TextSize = 14
AutoRunButton.Font = Enum.Font.GothamSemibold
AutoRunButton.Parent = AutoRunToggle

-- FlyUp Toggle (Angle Adjustment)
local FlyUpToggle = Instance.new("Frame")
FlyUpToggle.Name = "FlyUpToggle"
FlyUpToggle.Size = UDim2.new(1, 0, 0, 30)
FlyUpToggle.Position = UDim2.new(0, 0, 0, 120)
FlyUpToggle.BackgroundTransparency = 1
FlyUpToggle.Parent = AntiStunContent

local FlyUpLabel = Instance.new("TextLabel")
FlyUpLabel.Name = "FlyUpLabel"
FlyUpLabel.Size = UDim2.new(0.7, 0, 1, 0)
FlyUpLabel.BackgroundTransparency = 1
FlyUpLabel.Text = "FlyUp (Angle Adjustment)"
FlyUpLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyUpLabel.TextSize = 16
FlyUpLabel.Font = Enum.Font.Gotham
FlyUpLabel.TextXAlignment = Enum.TextXAlignment.Left
FlyUpLabel.Parent = FlyUpToggle

local FlyUpButton = Instance.new("TextButton")
FlyUpButton.Name = "FlyUpButton"
FlyUpButton.Size = UDim2.new(0.3, -10, 1, -10)
FlyUpButton.Position = UDim2.new(0.7, 0, 0, 5)
FlyUpButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
FlyUpButton.BorderSizePixel = 0
FlyUpButton.Text = "OFF"
FlyUpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyUpButton.TextSize = 14
FlyUpButton.Font = Enum.Font.GothamSemibold
FlyUpButton.Parent = FlyUpToggle

-- Enhanced Noclip Toggle (360° Wall Penetration)
local EnhancedNoclipToggle = Instance.new("Frame")
EnhancedNoclipToggle.Name = "EnhancedNoclipToggle"
EnhancedNoclipToggle.Size = UDim2.new(1, 0, 0, 30)
EnhancedNoclipToggle.Position = UDim2.new(0, 0, 0, 160)
EnhancedNoclipToggle.BackgroundTransparency = 1
EnhancedNoclipToggle.Parent = AntiStunContent

local EnhancedNoclipLabel = Instance.new("TextLabel")
EnhancedNoclipLabel.Name = "EnhancedNoclipLabel"
EnhancedNoclipLabel.Size = UDim2.new(0.7, 0, 1, 0)
EnhancedNoclipLabel.BackgroundTransparency = 1
EnhancedNoclipLabel.Text = "360° Wall Penetration"
EnhancedNoclipLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
EnhancedNoclipLabel.TextSize = 16
EnhancedNoclipLabel.Font = Enum.Font.Gotham
EnhancedNoclipLabel.TextXAlignment = Enum.TextXAlignment.Left
EnhancedNoclipLabel.Parent = EnhancedNoclipToggle

local EnhancedNoclipButton = Instance.new("TextButton")
EnhancedNoclipButton.Name = "EnhancedNoclipButton"
EnhancedNoclipButton.Size = UDim2.new(0.3, -10, 1, -10)
EnhancedNoclipButton.Position = UDim2.new(0.7, 0, 0, 5)
EnhancedNoclipButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
EnhancedNoclipButton.BorderSizePixel = 0
EnhancedNoclipButton.Text = "OFF"
EnhancedNoclipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
EnhancedNoclipButton.TextSize = 14
EnhancedNoclipButton.Font = Enum.Font.GothamSemibold
EnhancedNoclipButton.Parent = EnhancedNoclipToggle

-- ESP Sub-Menu
local ESPMenu = Instance.new("Frame")
ESPMenu.Name = "ESPMenu"
ESPMenu.Size = UDim2.new(0, 250, 0, 250)
ESPMenu.Position = UDim2.new(0, 310, 0, 100)
ESPMenu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ESPMenu.BorderSizePixel = 0
ESPMenu.Visible = false
ESPMenu.Parent = ScreenGui

local ESPTitle = Instance.new("TextLabel")
ESPTitle.Name = "ESPTitle"
ESPTitle.Size = UDim2.new(1, 0, 0, 30)
ESPTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPTitle.BorderSizePixel = 0
ESPTitle.Text = "ESP Options"
ESPTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPTitle.TextSize = 16
ESPTitle.Font = Enum.Font.GothamSemibold
ESPTitle.Parent = ESPMenu

local ESPContent = Instance.new("Frame")
ESPContent.Name = "ESPContent"
ESPContent.Size = UDim2.new(1, -20, 1, -40)
ESPContent.Position = UDim2.new(0, 10, 0, 35)
ESPContent.BackgroundTransparency = 1
ESPContent.Parent = ESPMenu

-- ESP Target Toggle
local ESPTargetToggle = Instance.new("Frame")
ESPTargetToggle.Name = "ESPTargetToggle"
ESPTargetToggle.Size = UDim2.new(1, 0, 0, 30)
ESPTargetToggle.Position = UDim2.new(0, 0, 0, 0)
ESPTargetToggle.BackgroundTransparency = 1
ESPTargetToggle.Parent = ESPContent

local ESPTargetLabel = Instance.new("TextLabel")
ESPTargetLabel.Name = "ESPTargetLabel"
ESPTargetLabel.Size = UDim2.new(0.7, 0, 1, 0)
ESPTargetLabel.BackgroundTransparency = 1
ESPTargetLabel.Text = "ESP Target"
ESPTargetLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPTargetLabel.TextSize = 16
ESPTargetLabel.Font = Enum.Font.Gotham
ESPTargetLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPTargetLabel.Parent = ESPTargetToggle

local ESPTargetButton = Instance.new("TextButton")
ESPTargetButton.Name = "ESPTargetButton"
ESPTargetButton.Size = UDim2.new(0.3, -10, 1, -10)
ESPTargetButton.Position = UDim2.new(0.7, 0, 0, 5)
ESPTargetButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPTargetButton.BorderSizePixel = 0
ESPTargetButton.Text = "OFF"
ESPTargetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPTargetButton.TextSize = 14
ESPTargetButton.Font = Enum.Font.GothamSemibold
ESPTargetButton.Parent = ESPTargetToggle

-- ESP All Players Toggle
local ESPAllToggle = Instance.new("Frame")
ESPAllToggle.Name = "ESPAllToggle"
ESPAllToggle.Size = UDim2.new(1, 0, 0, 30)
ESPAllToggle.Position = UDim2.new(0, 0, 0, 40)
ESPAllToggle.BackgroundTransparency = 1
ESPAllToggle.Parent = ESPContent

local ESPAllLabel = Instance.new("TextLabel")
ESPAllLabel.Name = "ESPAllLabel"
ESPAllLabel.Size = UDim2.new(0.7, 0, 1, 0)
ESPAllLabel.BackgroundTransparency = 1
ESPAllLabel.Text = "ESP All Players"
ESPAllLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPAllLabel.TextSize = 16
ESPAllLabel.Font = Enum.Font.Gotham
ESPAllLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPAllLabel.Parent = ESPAllToggle

local ESPAllButton = Instance.new("TextButton")
ESPAllButton.Name = "ESPAllButton"
ESPAllButton.Size = UDim2.new(0.3, -10, 1, -10)
ESPAllButton.Position = UDim2.new(0.7, 0, 0, 5)
ESPAllButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPAllButton.BorderSizePixel = 0
ESPAllButton.Text = "OFF"
ESPAllButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPAllButton.TextSize = 14
ESPAllButton.Font = Enum.Font.GothamSemibold
ESPAllButton.Parent = ESPAllToggle

-- ESP Lines Toggle
local ESPLinesToggle = Instance.new("Frame")
ESPLinesToggle.Name = "ESPLinesToggle"
ESPLinesToggle.Size = UDim2.new(1, 0, 0, 30)
ESPLinesToggle.Position = UDim2.new(0, 0, 0, 80)
ESPLinesToggle.BackgroundTransparency = 1
ESPLinesToggle.Parent = ESPContent

local ESPLinesLabel = Instance.new("TextLabel")
ESPLinesLabel.Name = "ESPLinesLabel"
ESPLinesLabel.Size = UDim2.new(0.7, 0, 1, 0)
ESPLinesLabel.BackgroundTransparency = 1
ESPLinesLabel.Text = "ESP Lines"
ESPLinesLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPLinesLabel.TextSize = 16
ESPLinesLabel.Font = Enum.Font.Gotham
ESPLinesLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPLinesLabel.Parent = ESPLinesToggle

local ESPLinesButton = Instance.new("TextButton")
ESPLinesButton.Name = "ESPLinesButton"
ESPLinesButton.Size = UDim2.new(0.3, -10, 1, -10)
ESPLinesButton.Position = UDim2.new(0.7, 0, 0, 5)
ESPLinesButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPLinesButton.BorderSizePixel = 0
ESPLinesButton.Text = "OFF"
ESPLinesButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPLinesButton.TextSize = 14
ESPLinesButton.Font = Enum.Font.GothamSemibold
ESPLinesButton.Parent = ESPLinesToggle

-- ESP Names Toggle
local ESPNamesToggle = Instance.new("Frame")
ESPNamesToggle.Name = "ESPNamesToggle"
ESPNamesToggle.Size = UDim2.new(1, 0, 0, 30)
ESPNamesToggle.Position = UDim2.new(0, 0, 0, 120)
ESPNamesToggle.BackgroundTransparency = 1
ESPNamesToggle.Parent = ESPContent

local ESPNamesLabel = Instance.new("TextLabel")
ESPNamesLabel.Name = "ESPNamesLabel"
ESPNamesLabel.Size = UDim2.new(0.7, 0, 1, 0)
ESPNamesLabel.BackgroundTransparency = 1
ESPNamesLabel.Text = "ESP Names"
ESPNamesLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPNamesLabel.TextSize = 16
ESPNamesLabel.Font = Enum.Font.Gotham
ESPNamesLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPNamesLabel.Parent = ESPNamesToggle

local ESPNamesButton = Instance.new("TextButton")
ESPNamesButton.Name = "ESPNamesButton"
ESPNamesButton.Size = UDim2.new(0.3, -10, 1, -10)
ESPNamesButton.Position = UDim2.new(0.7, 0, 0, 5)
ESPNamesButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPNamesButton.BorderSizePixel = 0
ESPNamesButton.Text = "OFF"
ESPNamesButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPNamesButton.TextSize = 14
ESPNamesButton.Font = Enum.Font.GothamSemibold
ESPNamesButton.Parent = ESPNamesToggle

-- ESP Hitbox Toggle
local ESPHitboxToggle = Instance.new("Frame")
ESPHitboxToggle.Name = "ESPHitboxToggle"
ESPHitboxToggle.Size = UDim2.new(1, 0, 0, 30)
ESPHitboxToggle.Position = UDim2.new(0, 0, 0, 160)
ESPHitboxToggle.BackgroundTransparency = 1
ESPHitboxToggle.Parent = ESPContent

local ESPHitboxLabel = Instance.new("TextLabel")
ESPHitboxLabel.Name = "ESPHitboxLabel"
ESPHitboxLabel.Size = UDim2.new(0.7, 0, 1, 0)
ESPHitboxLabel.BackgroundTransparency = 1
ESPHitboxLabel.Text = "ESP Hitbox"
ESPHitboxLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPHitboxLabel.TextSize = 16
ESPHitboxLabel.Font = Enum.Font.Gotham
ESPHitboxLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPHitboxLabel.Parent = ESPHitboxToggle

local ESPHitboxButton = Instance.new("TextButton")
ESPHitboxButton.Name = "ESPHitboxButton"
ESPHitboxButton.Size = UDim2.new(0.3, -10, 1, -10)
ESPHitboxButton.Position = UDim2.new(0.7, 0, 0, 5)
ESPHitboxButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPHitboxButton.BorderSizePixel = 0
ESPHitboxButton.Text = "OFF"
ESPHitboxButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPHitboxButton.TextSize = 14
ESPHitboxButton.Font = Enum.Font.GothamSemibold
ESPHitboxButton.Parent = ESPHitboxToggle

-- Player List Sub-Menu
local PlayerListMenu = Instance.new("Frame")
PlayerListMenu.Name = "PlayerListMenu"
PlayerListMenu.Size = UDim2.new(0, 250, 0, 300)
PlayerListMenu.Position = UDim2.new(0, 310, 0, 100)
PlayerListMenu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
PlayerListMenu.BorderSizePixel = 0
PlayerListMenu.Visible = false
PlayerListMenu.Parent = ScreenGui

local PlayerListTitle = Instance.new("TextLabel")
PlayerListTitle.Name = "PlayerListTitle"
PlayerListTitle.Size = UDim2.new(1, 0, 0, 30)
PlayerListTitle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
PlayerListTitle.BorderSizePixel = 0
PlayerListTitle.Text = "Player List"
PlayerListTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerListTitle.TextSize = 16
PlayerListTitle.Font = Enum.Font.GothamSemibold
PlayerListTitle.Parent = PlayerListMenu

local PlayerListContent = Instance.new("Frame")
PlayerListContent.Name = "PlayerListContent"
PlayerListContent.Size = UDim2.new(1, -20, 1, -40)
PlayerListContent.Position = UDim2.new(0, 10, 0, 35)
PlayerListContent.BackgroundTransparency = 1
PlayerListContent.Parent = PlayerListMenu

-- Offset Input
local OffsetFrame = Instance.new("Frame")
OffsetFrame.Name = "OffsetFrame"
OffsetFrame.Size = UDim2.new(1, 0, 0, 70)
OffsetFrame.Position = UDim2.new(0, 0, 0, 0)
OffsetFrame.BackgroundTransparency = 1
OffsetFrame.Parent = PlayerListContent

local OffsetLabel = Instance.new("TextLabel")
OffsetLabel.Name = "OffsetLabel"
OffsetLabel.Size = UDim2.new(1, 0, 0, 20)
OffsetLabel.BackgroundTransparency = 1
OffsetLabel.Text = "Position Offset (X, Y, Z)"
OffsetLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
OffsetLabel.TextSize = 16
OffsetLabel.Font = Enum.Font.Gotham
OffsetLabel.TextXAlignment = Enum.TextXAlignment.Left
OffsetLabel.Parent = OffsetFrame

local XInput = Instance.new("TextBox")
XInput.Name = "XInput"
XInput.Size = UDim2.new(0.3, -5, 0, 30)
XInput.Position = UDim2.new(0, 0, 0, 30)
XInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
XInput.BorderSizePixel = 0
XInput.Text = "0"
XInput.TextColor3 = Color3.fromRGB(255, 255, 255)
XInput.TextSize = 14
XInput.Font = Enum.Font.Gotham
XInput.Parent = OffsetFrame

local YInput = Instance.new("TextBox")
YInput.Name = "YInput"
YInput.Size = UDim2.new(0.3, -5, 0, 30)
YInput.Position = UDim2.new(0.35, 0, 0, 30)
YInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
YInput.BorderSizePixel = 0
YInput.Text = "0"
YInput.TextColor3 = Color3.fromRGB(255, 255, 255)
YInput.TextSize = 14
YInput.Font = Enum.Font.Gotham
YInput.Parent = OffsetFrame

local ZInput = Instance.new("TextBox")
ZInput.Name = "ZInput"
ZInput.Size = UDim2.new(0.3, -5, 0, 30)
ZInput.Position = UDim2.new(0.7, 0, 0, 30)
ZInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ZInput.BorderSizePixel = 0
ZInput.Text = "0"
ZInput.TextColor3 = Color3.fromRGB(255, 255, 255)
ZInput.TextSize = 14
ZInput.Font = Enum.Font.Gotham
ZInput.Parent = OffsetFrame

-- Player List
local PlayerListFrame = Instance.new("Frame")
PlayerListFrame.Name = "PlayerListFrame"
PlayerListFrame.Size = UDim2.new(1, 0, 0, 180)
PlayerListFrame.Position = UDim2.new(0, 0, 0, 80)
PlayerListFrame.BackgroundTransparency = 1
PlayerListFrame.Parent = PlayerListContent

local PlayerListLabel = Instance.new("TextLabel")
PlayerListLabel.Name = "PlayerListLabel"
PlayerListLabel.Size = UDim2.new(0.7, 0, 0, 20)
PlayerListLabel.BackgroundTransparency = 1
PlayerListLabel.Text = "Select Player"
PlayerListLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerListLabel.TextSize = 16
PlayerListLabel.Font = Enum.Font.Gotham
PlayerListLabel.TextXAlignment = Enum.TextXAlignment.Left
PlayerListLabel.Parent = PlayerListFrame

local RefreshButton = Instance.new("TextButton")
RefreshButton.Name = "RefreshButton"
RefreshButton.Size = UDim2.new(0.3, -10, 0, 20)
RefreshButton.Position = UDim2.new(0.7, 0, 0, 0)
RefreshButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
RefreshButton.BorderSizePixel = 0
RefreshButton.Text = "Refresh"
RefreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RefreshButton.TextSize = 14
RefreshButton.Font = Enum.Font.GothamSemibold
RefreshButton.Parent = PlayerListFrame

local PlayerScrollFrame = Instance.new("ScrollingFrame")
PlayerScrollFrame.Name = "PlayerScrollFrame"
PlayerScrollFrame.Size = UDim2.new(1, 0, 0, 150)
PlayerScrollFrame.Position = UDim2.new(0, 0, 0, 30)
PlayerScrollFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
PlayerScrollFrame.BorderSizePixel = 0
PlayerScrollFrame.ScrollBarThickness = 4
PlayerScrollFrame.ScrollingDirection = Enum.ScrollingDirection.Y
PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerScrollFrame.Parent = PlayerListFrame

local PlayerListLayout = Instance.new("UIListLayout")
PlayerListLayout.Name = "PlayerListLayout"
PlayerListLayout.SortOrder = Enum.SortOrder.Name
PlayerListLayout.Padding = UDim.new(0, 2)
PlayerListLayout.Parent = PlayerScrollFrame

-- ESP Container for visual elements
local ESPContainer = Instance.new("Folder")
ESPContainer.Name = "ESPContainer"
ESPContainer.Parent = ScreenGui

-- Variables
local flyEnabled = false
local noclipEnabled = false
local noStunEnabled = false
local noStunV2Enabled = false
local continuousEnabled = false
local autoTeleportEnabled = false
local espTargetEnabled = false
local espAllEnabled = false
local espLinesEnabled = false
local espNamesEnabled = false
local espHitboxEnabled = false
local flySpeed = 50
local selectedPlayer = nil
local flyConnection = nil
local noclipConnection = nil
local noStunConnection = nil
local noStunV2Connection = nil
local autoTeleportConnection = nil
local espUpdateConnection = nil
local activeSubMenu = nil
local autoRunEnabled = false
local flyUpEnabled = false
local enhancedNoclipEnabled = false
local autoRunConnection = nil
local flyUpConnection = nil
local enhancedNoclipConnection = nil
local emergencyPosition = nil
local isInEmergency = false

-- Functions
local function updatePlayerList()
    -- Clear existing buttons
    for _, child in pairs(PlayerScrollFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    -- Add player buttons
    local buttonHeight = 25
    local totalHeight = 0
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local PlayerButton = Instance.new("TextButton")
            PlayerButton.Name = player.Name .. "Button"
            PlayerButton.Size = UDim2.new(1, -8, 0, buttonHeight)
            PlayerButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            PlayerButton.BorderSizePixel = 0
            PlayerButton.Text = player.Name
            PlayerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            PlayerButton.TextSize = 14
            PlayerButton.Font = Enum.Font.Gotham
            PlayerButton.Parent = PlayerScrollFrame
            
            PlayerButton.MouseButton1Click:Connect(function()
                selectedPlayer = player
                for _, btn in pairs(PlayerScrollFrame:GetChildren()) do
                    if btn:IsA("TextButton") then
                        if btn == PlayerButton then
                            btn.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
                        else
                            btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
                        end
                    end
                end
            end)
            
            totalHeight = totalHeight + buttonHeight + 2 -- 2 is the padding
        end
    end
    
    PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
end

local function toggleFly()
    flyEnabled = not flyEnabled
    
    if flyEnabled then
        FlyButton.Text = "ON"
        FlyButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if flyConnection then
            flyConnection:Disconnect()
        end
        
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            local hrp = character.HumanoidRootPart
            
            flyConnection = RunService.Heartbeat:Connect(function()
                if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local targetHrp = selectedPlayer.Character.HumanoidRootPart
                    local offsetX = tonumber(XInput.Text) or 0
                    local offsetY = tonumber(YInput.Text) or 0
                    local offsetZ = tonumber(ZInput.Text) or 0
                    local targetPosition = targetHrp.Position + Vector3.new(offsetX, offsetY, offsetZ)
                    
                    local direction = (targetPosition - hrp.Position).Unit
                    local distance = (targetPosition - hrp.Position).Magnitude
                    
                    -- Get speed from input
                    local speed = tonumber(SpeedInput.Text) or 50
                    flySpeed = math.clamp(speed, 1, 500)
                    
                    -- Apply FlyUp angle adjustment for long distances
                    if flyUpEnabled and distance > 50 then
                        -- Add upward component to direction vector
                        local upwardBias = 0.2 -- Adjust this value to control the upward angle
                        direction = (direction + Vector3.new(0, upwardBias, 0)).Unit
                    end
                    
                    if continuousEnabled or distance > 5 then
                        hrp.Velocity = direction * flySpeed
                    else
                        hrp.Velocity = Vector3.new(0, 0, 0)
                    end
                end
            end)
        end
    else
        FlyButton.Text = "OFF"
        FlyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
        
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
        end
    end
end

local function toggleNoclip()
    noclipEnabled = not noclipEnabled
    
    if noclipEnabled then
        NoclipButton.Text = "ON"
        NoclipButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if noclipConnection then
            noclipConnection:Disconnect()
        end
        
        noclipConnection = RunService.Stepped:Connect(function()
            local character = LocalPlayer.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        NoclipButton.Text = "OFF"
        NoclipButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        
        local character = LocalPlayer.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

local function toggleNoStun()
    noStunEnabled = not noStunEnabled
    
    if noStunEnabled then
        NoStunButton.Text = "ON"
        NoStunButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if noStunConnection then
            noStunConnection:Disconnect()
        end
        
        noStunConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    -- Prevent stun by resetting these properties
                    humanoid.PlatformStand = false
                    humanoid.Sit = false
                    
                    -- Reset animation if it's a stun animation
                    if humanoid:GetState() == Enum.HumanoidStateType.Ragdoll or
                       humanoid:GetState() == Enum.HumanoidStateType.Stunned or
                       humanoid:GetState() == Enum.HumanoidStateType.FallingDown then
                        humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
                    end
                end
            end
        end)
    else
        NoStunButton.Text = "OFF"
        NoStunButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if noStunConnection then
            noStunConnection:Disconnect()
            noStunConnection = nil
        end
    end
end

local function toggleNoStunV2()
    noStunV2Enabled = not noStunV2Enabled
    
    if noStunV2Enabled then
        NoStunV2Button.Text = "ON"
        NoStunV2Button.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if noStunV2Connection then
            noStunV2Connection:Disconnect()
        end
        
        noStunV2Connection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    -- Advanced anti-stun and anti-freeze (for games like BloxFruits)
                    humanoid.PlatformStand = false
                    humanoid.Sit = false
                    humanoid.AutoRotate = true
                    
                    -- Override animation states
                    if humanoid:GetState() ~= Enum.HumanoidStateType.Running and
                       humanoid:GetState() ~= Enum.HumanoidStateType.Jumping and
                       humanoid:GetState() ~= Enum.HumanoidStateType.Climbing and
                       humanoid:GetState() ~= Enum.HumanoidStateType.Swimming then
                        humanoid:ChangeState(Enum.HumanoidStateType.Running)
                    end
                    
                    -- Ensure character can move by checking and resetting velocity
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and part.Anchored then
                            part.Anchored = false
                        end
                    end
                    
                    -- Override any scripts that might be freezing the character
                    if character.HumanoidRootPart.Anchored then
                        character.HumanoidRootPart.Anchored = false
                    end
                end
            end
        end)
    else
        NoStunV2Button.Text = "OFF"
        NoStunV2Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if noStunV2Connection then
            noStunV2Connection:Disconnect()
            noStunV2Connection = nil
        end
    end
end

local function toggleContinuous()
    continuousEnabled = not continuousEnabled
    
    if continuousEnabled then
        ContinuousButton.Text = "ON"
        ContinuousButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ContinuousButton.Text = "OFF"
        ContinuousButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
end

local function teleportToPlayer()
    if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            local targetHrp = selectedPlayer.Character.HumanoidRootPart
            local offsetX = tonumber(XInput.Text) or 0
            local offsetY = tonumber(YInput.Text) or 0
            local offsetZ = tonumber(ZInput.Text) or 0
            local targetPosition = targetHrp.Position + Vector3.new(offsetX, offsetY, offsetZ)
            
            character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        end
    end
end

local function toggleAutoTeleport()
    autoTeleportEnabled = not autoTeleportEnabled
    
    if autoTeleportEnabled then
        AutoTeleportButton.Text = "ON"
        AutoTeleportButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if autoTeleportConnection then
            autoTeleportConnection:Disconnect()
        end
        
        autoTeleportConnection = RunService.Heartbeat:Connect(function()
            teleportToPlayer()
        end)
    else
        AutoTeleportButton.Text = "OFF"
        AutoTeleportButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if autoTeleportConnection then
            autoTeleportConnection:Disconnect()
            autoTeleportConnection = nil
        end
    end
end

-- ESP Functions
local function createESPItem(player)
    -- Create ESP folder for this player
    local espFolder = Instance.new("Folder")
    espFolder.Name = player.Name .. "_ESP"
    espFolder.Parent = ESPContainer
    
    -- Create box highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "Highlight"
    highlight.FillColor = player == selectedPlayer and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    highlight.Enabled = false
    highlight.Parent = espFolder
    
    -- Create ESP name billboard
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "NameESP"
    billboardGui.Size = UDim2.new(0, 200, 0, 50)
    billboardGui.StudsOffset = Vector3.new(0, 3, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.LightInfluence = 0
    billboardGui.Enabled = false
    billboardGui.Parent = espFolder
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = player == selectedPlayer and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextSize = 18
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = billboardGui
    
    -- Create ESP line
    local line = Instance.new("LineHandleAdornment")
    line.Name = "Line"
    line.Color3 = player == selectedPlayer and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
    line.Thickness = 2
    line.ZIndex = 1
    line.Transparency = 0
    line.Visible = false
    line.Parent = espFolder
    
    return espFolder
end

local function updateESP()
    -- Clear existing ESP
    ESPContainer:ClearAllChildren()
    
    -- Create new ESP for each player
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local isTarget = (player == selectedPlayer)
            
            -- Only create ESP for target or all players based on settings
            if (isTarget and espTargetEnabled) or (espAllEnabled) then
                local espFolder = createESPItem(player)
                
                -- Apply ESP to player character
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    -- Update highlight
                    local highlight = espFolder:FindFirstChild("Highlight")
                    if highlight then
                        highlight.Enabled = true
                        highlight.Parent = player.Character
                    end
                    
                    -- Update name ESP
                    local nameESP = espFolder:FindFirstChild("NameESP")
                    if nameESP and espNamesEnabled then
                        nameESP.Enabled = true
                        nameESP.Adornee = player.Character.Head
                    end
                    
                    -- Update line ESP
                    local line = espFolder:FindFirstChild("Line")
                    if line and espLinesEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        line.Visible = true
                        line.Adornee = workspace
                        line.Length = 1000
                        line.CFrame = CFrame.new(
                            LocalPlayer.Character.HumanoidRootPart.Position,
                            player.Character.HumanoidRootPart.Position
                        )
                    end
                    
                    -- Update hitbox ESP
                    if espHitboxEnabled then
                        for _, part in pairs(player.Character:GetDescendants()) do
                            if part:IsA("BasePart") then
                                local boxHandleAdornment = Instance.new("BoxHandleAdornment")
                                boxHandleAdornment.Name = part.Name .. "_Hitbox"
                                boxHandleAdornment.Adornee = part
                                boxHandleAdornment.AlwaysOnTop = true
                                boxHandleAdornment.ZIndex = 10
                                boxHandleAdornment.Size = part.Size
                                boxHandleAdornment.Transparency = 0.7
                                boxHandleAdornment.Color3 = isTarget and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
                                boxHandleAdornment.Parent = espFolder
                            end
                        end
                    end
                end
            end
        end
    end
end

local function toggleESPTarget()
    espTargetEnabled = not espTargetEnabled
    
    if espTargetEnabled then
        ESPTargetButton.Text = "ON"
        ESPTargetButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ESPTargetButton.Text = Color3.fromRGB(45, 45, 45)
    end
    
    updateESP()
end

local function toggleESPAll()
    espAllEnabled = not espAllEnabled
    
    if espAllEnabled then
        ESPAllButton.Text = "ON"
        ESPAllButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ESPAllButton.Text = "OFF"
        ESPAllButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
    
    updateESP()
end

local function toggleESPLines()
    espLinesEnabled = not espLinesEnabled
    
    if espLinesEnabled then
        ESPLinesButton.Text = "ON"
        ESPLinesButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ESPLinesButton.Text = "OFF"
        ESPLinesButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
    
    updateESP()
end

local function toggleESPNames()
    espNamesEnabled = not espNamesEnabled
    
    if espNamesEnabled then
        ESPNamesButton.Text = "ON"
        ESPNamesButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ESPNamesButton.Text = "OFF"
        ESPNamesButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
    
    updateESP()
end

local function toggleESPHitbox()
    espHitboxEnabled = not espHitboxEnabled
    
    if espHitboxEnabled then
        ESPHitboxButton.Text = "ON"
        ESPHitboxButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        ESPHitboxButton.Text = "OFF"
        ESPHitboxButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
    
    updateESP()
end

local function toggleAutoRun()
    autoRunEnabled = not autoRunEnabled
    
    if autoRunEnabled then
        AutoRunButton.Text = "ON"
        AutoRunButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if autoRunConnection then
            autoRunConnection:Disconnect()
        end
        
        autoRunConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    local healthPercent = humanoid.Health / humanoid.MaxHealth * 100
                    
                    if healthPercent <= 50 and not isInEmergency then
                        -- Store current position for return
                        if character:FindFirstChild("HumanoidRootPart") then
                            emergencyPosition = character.HumanoidRootPart.Position
                            isInEmergency = true
                            
                            -- First teleport up 3000 blocks instantly
                            local currentPos = character.HumanoidRootPart.Position
                            character.HumanoidRootPart.CFrame = CFrame.new(currentPos.X, currentPos.Y + 3000, currentPos.Z)
                            
                            -- Then continue flying up at 200 blocks per second
                            local upwardVelocity = Vector3.new(0, 200, 0)
                            character.HumanoidRootPart.Velocity = upwardVelocity
                        end
                    elseif healthPercent > 51 and isInEmergency then
                        -- Return to original position
                        if character:FindFirstChild("HumanoidRootPart") and emergencyPosition then
                            character.HumanoidRootPart.CFrame = CFrame.new(emergencyPosition)
                            isInEmergency = false
                        end
                    end
                    
                    -- If in emergency mode, keep flying up at 200 blocks per second
                    if isInEmergency and character:FindFirstChild("HumanoidRootPart") then
                        character.HumanoidRootPart.Velocity = Vector3.new(0, 200, 0)
                    end
                end
            end
        end)
    else
        AutoRunButton.Text = "OFF"
        AutoRunButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if autoRunConnection then
            autoRunConnection:Disconnect()
            autoRunConnection = nil
        end
        
        -- If we were in emergency mode, return to original position
        if isInEmergency and emergencyPosition then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                character.HumanoidRootPart.CFrame = CFrame.new(emergencyPosition)
            end
            isInEmergency = false
        end
    end
end

local function toggleFlyUp()
    flyUpEnabled = not flyUpEnabled
    
    if flyUpEnabled then
        FlyUpButton.Text = "ON"
        FlyUpButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    else
        FlyUpButton.Text = "OFF"
        FlyUpButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
    
    -- The actual functionality is integrated into the fly function
    -- No need for a separate connection
end

local function toggleEnhancedNoclip()
    enhancedNoclipEnabled = not enhancedNoclipEnabled
    
    if enhancedNoclipEnabled then
        EnhancedNoclipButton.Text = "ON"
        EnhancedNoclipButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
        
        if enhancedNoclipConnection then
            enhancedNoclipConnection:Disconnect()
        end
        
        enhancedNoclipConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character then
                -- Get all parts in a radius around the character
                local hrp = character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local radius = 10 -- 360° penetration radius
                    local parts = workspace:GetPartBoundsInRadius(hrp.Position, radius)
                    
                    -- Disable collision for all these parts
                    for _, part in ipairs(parts) do
                        if part:IsA("BasePart") and part.CanCollide and not part:IsDescendantOf(character) then
                            part.CanCollide = false
                        end
                    end
                    
                    -- Also disable collision for character parts
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and part.CanCollide then
                            part.CanCollide = false
                        end
                    end
                end
            end
        end)
    else
        EnhancedNoclipButton.Text = "OFF"
        EnhancedNoclipButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        
        if enhancedNoclipConnection then
            enhancedNoclipConnection:Disconnect()
            enhancedNoclipConnection = nil
        end
    end
end

-- Sub-menu management
local function hideAllSubMenus()
    MovementMenu.Visible = false
    AntiStunMenu.Visible = false
    ESPMenu.Visible = false
    PlayerListMenu.Visible = false
    activeSubMenu = nil
end

local function toggleSubMenu(menu)
    if activeSubMenu == menu then
        menu.Visible = false
        activeSubMenu = nil
    else
        hideAllSubMenus()
        menu.Visible = true
        activeSubMenu = menu
        
        -- Position the sub-menu next to the main menu
        menu.Position = UDim2.new(0, MainFrame.AbsolutePosition.X + MainFrame.AbsoluteSize.X + 10, 0, MainFrame.AbsolutePosition.Y)
    end
end

local function toggleMainFrame()
    MainFrame.Visible = not MainFrame.Visible
    CircleIcon.Visible = not MainFrame.Visible
    
    if not MainFrame.Visible then
        hideAllSubMenus()
    end
end

-- Connect events
CircleIcon.MouseButton1Click:Connect(toggleMainFrame)

CloseButton.MouseButton1Click:Connect(function()
    if flyConnection then flyConnection:Disconnect() end
    if noclipConnection then noclipConnection:Disconnect() end
    if noStunConnection then noStunConnection:Disconnect() end
    if noStunV2Connection then noStunV2Connection:Disconnect() end
    if autoTeleportConnection then autoTeleportConnection:Disconnect() end
    if espUpdateConnection then espUpdateConnection:Disconnect() end
    if autoRunConnection then autoRunConnection:Disconnect() end
    if enhancedNoclipConnection then enhancedNoclipConnection:Disconnect() end
    ScreenGui:Destroy()
end)

MinimizeButton.MouseButton1Click:Connect(toggleMainFrame)

-- Main menu buttons
FlyButton.MouseButton1Click:Connect(toggleFly)
MovementButton.MouseButton1Click:Connect(function() toggleSubMenu(MovementMenu) end)
AntiStunButton.MouseButton1Click:Connect(function() toggleSubMenu(AntiStunMenu) end)
ESPButton.MouseButton1Click:Connect(function() toggleSubMenu(ESPMenu) end)
PlayerListButton.MouseButton1Click:Connect(function() 
    toggleSubMenu(PlayerListMenu)
    updatePlayerList() -- Refresh player list when opening
end)

-- Movement sub-menu buttons
NoclipButton.MouseButton1Click:Connect(toggleNoclip)
ContinuousButton.MouseButton1Click:Connect(toggleContinuous)
TeleportButton.MouseButton1Click:Connect(teleportToPlayer)
AutoTeleportButton.MouseButton1Click:Connect(toggleAutoTeleport)

-- Anti-Stun sub-menu buttons
NoStunButton.MouseButton1Click:Connect(toggleNoStun)
NoStunV2Button.MouseButton1Click:Connect(toggleNoStunV2)
AutoRunButton.MouseButton1Click:Connect(toggleAutoRun)
FlyUpButton.MouseButton1Click:Connect(toggleFlyUp)
EnhancedNoclipButton.MouseButton1Click:Connect(toggleEnhancedNoclip)

-- ESP sub-menu buttons
ESPTargetButton.MouseButton1Click:Connect(toggleESPTarget)
ESPAllButton.MouseButton1Click:Connect(toggleESPAll)
ESPLinesButton.MouseButton1Click:Connect(toggleESPLines)
ESPNamesButton.MouseButton1Click:Connect(toggleESPNames)
ESPHitboxButton.MouseButton1Click:Connect(toggleESPHitbox)

-- Player List sub-menu buttons
RefreshButton.MouseButton1Click:Connect(updatePlayerList)

-- Speed input validation
SpeedInput.FocusLost:Connect(function(enterPressed)
    local speed = tonumber(SpeedInput.Text)
    if speed then
        flySpeed = math.clamp(speed, 1, 500)
        SpeedInput.Text = tostring(flySpeed)
    else
        SpeedInput.Text = tostring(flySpeed)
    end
end)

-- Initialize
updatePlayerList()

-- Set up ESP update loop
espUpdateConnection = RunService.RenderStepped:Connect(function()
    if espTargetEnabled or espAllEnabled then
        updateESP()
    end
end)

-- Player added/removed events
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

-- Make corners rounded
local function makeRounded(instance, radius)
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, radius)
    uiCorner.Parent = instance
end

-- Apply rounded corners to all UI elements
makeRounded(MainFrame, 8)
makeRounded(TitleBar, 8)
makeRounded(FlyButton, 4)
makeRounded(SpeedInput, 4)
makeRounded(MovementButton, 6)
makeRounded(AntiStunButton, 6)
makeRounded(ESPButton, 6)
makeRounded(PlayerListButton, 6)

makeRounded(MovementMenu, 8)
makeRounded(MovementTitle, 8)
makeRounded(NoclipButton, 4)
makeRounded(ContinuousButton, 4)
makeRounded(TeleportButton, 4)
makeRounded(AutoTeleportButton, 4)

makeRounded(AntiStunMenu, 8)
makeRounded(AntiStunTitle, 8)
makeRounded(NoStunButton, 4)
makeRounded(NoStunV2Button, 4)
makeRounded(AutoRunButton, 4)
makeRounded(FlyUpButton, 4)
makeRounded(EnhancedNoclipButton, 4)

makeRounded(ESPMenu, 8)
makeRounded(ESPTitle, 8)
makeRounded(ESPTargetButton, 4)
makeRounded(ESPAllButton, 4)
makeRounded(ESPLinesButton, 4)
makeRounded(ESPNamesButton, 4)
makeRounded(ESPHitboxButton, 4)

makeRounded(PlayerListMenu, 8)
makeRounded(PlayerListTitle, 8)
makeRounded(XInput, 4)
makeRounded(YInput, 4)
makeRounded(ZInput, 4)
makeRounded(RefreshButton, 4)
makeRounded(PlayerScrollFrame, 4)
